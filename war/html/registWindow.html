<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height,initial-scale=1.0">
<title>REGISTER</title>
</head>
<script type="text/javascript"
	src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
window.onload = function() {

	var id = window.opener.uid;
	document.forms[0].elements['userId'].value = id;
}

function clickOK() {

	if (confirm("register ？")) {

		// registUserInfo()実行かつ戻り値取得
		var _return = registUserInfo();
		var obj = JSON.parse(_return);

		if (obj['message'] == "success") {

			alert("successfully registered .");
			// ユーザIDを親画面に埋め込み
			window.opener.document.getElementById('memo').innerHTML = "USER ID：" + obj['userid'];
			// トークンを親画面に埋め込み
			window.opener.document.forms[0].token.value = obj['token'];

			// 閉じる
			window.close();
		} else {
			alert("fail to register ...");
		}
	}
}

function registUserInfo() {

	var param1 = document.forms[0].userId.value;
	var param2 = document.forms[0].userPassword.value;

	return $.ajax({
		url : '/RegistUserInfo',
		// async(非同期) : false
		async : false,
		type : 'POST',
		dataType : 'json',
		data : {
			parameter1 : param1,
			parameter2 : param2
		},
		timeout : 10000,
		success : function(data) {
			// alert("成功");
		},
		error : function(XMLHttpRequest, textStatus, errorThrown) {
			// alert("失敗");
		}
	}).responseText;
}
</script>
<body>
<form>
<table border="1">
<tr>
	<th>ID</th>
	<td><input type="text" id="userId" name="userId" value="" size="36" disabled></td>
</tr>
<tr>
	<th>Password</th>
	<td><input type="text" id="userPassword" name="userPassword" size="36"value="" size="36"></td>
</tr>
</table>
<br>
※ ID：auto　Password：anything
<br>
<br>
<br>
<input type="button" id="" name="" value="OK" onclick="clickOK()"/>
</form>
</body>
</html>